<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Health Chatbot</title>

  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Arial, sans-serif;
      background: #f7f7f8;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .header {
      background: #4a61dd;
      padding: 15px 20px;
      color: white;
      font-size: 22px;
      font-weight: bold;
    }

    .chat-box {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* Message wrapper */
    .msg-wrapper {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      max-width: 80%;
    }

    /* Avatars */
    .avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
    }

    .avatar.user {
      background-image: url("https://cdn-icons-png.flaticon.com/512/847/847969.png");
    }

    .avatar.bot {
      background-image: url("https://cdn-icons-png.flaticon.com/512/4712/4712100.png");
    }

    .msg {
      padding: 12px 16px;
      border-radius: 12px;
      font-size: 15px;
      line-height: 1.4;
    }

    .user-msg {
      align-self: flex-end;
      background: #d1e8ff;
      border-bottom-right-radius: 2px;
    }

    .bot-msg {
      background: white;
      border: 1px solid #ddd;
      border-bottom-left-radius: 2px;
    }

    /* Typing indicator */
    .typing {
      display: flex;
      gap: 4px;
      padding: 10px 16px;
      background: white;
      border: 1px solid #ddd;
      width: 55px;
      border-radius: 12px;
    }

    .dot {
      width: 8px;
      height: 8px;
      background: #888;
      border-radius: 50%;
      animation: blink 1.4s infinite;
    }

    .dot:nth-child(2) { animation-delay: 0.2s; }
    .dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes blink {
      0% { opacity: 0.2; }
      50% { opacity: 1; }
      100% { opacity: 0.2; }
    }

    /* Input Bar */
    .input-bar {
      display: flex;
      padding: 15px;
      background: white;
      border-top: 1px solid #ddd;
    }

    .input-bar input {
      flex: 1;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 15px;
    }

    .input-bar button {
      margin-left: 10px;
      padding: 12px 18px;
      background: #4a61dd;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 15px;
    }
  </style>
</head>

<body>

  <div class="header">Health Chatbot</div>

  <div class="chat-box" id="chatBox"></div>

  <div class="input-bar">
    <input id="question" placeholder="Type your question..." />
    <button onclick="sendMessage()">Send</button>
  </div>

  <script>
    function addMessage(text, sender) {
      const box = document.getElementById("chatBox");

      const wrap = document.createElement("div");
      wrap.className = "msg-wrapper";
      wrap.style.alignSelf = sender === "user" ? "flex-end" : "flex-start";

      const avatar = document.createElement("div");
      avatar.className = "avatar " + sender;

      const msg = document.createElement("div");
      msg.className = "msg " + (sender === "user" ? "user-msg" : "bot-msg");
      msg.innerText = text;

      // User messages do NOT show user avatar on left side
      if (sender === "user") {
        wrap.appendChild(msg);
        wrap.appendChild(avatar);
      } else {
        wrap.appendChild(avatar);
        wrap.appendChild(msg);
      }

      box.appendChild(wrap);
      box.scrollTop = box.scrollHeight;
    }

    function showTyping() {
      const box = document.getElementById("chatBox");

      const wrap = document.createElement("div");
      wrap.className = "msg-wrapper";
      wrap.id = "typingIndicator";

      const avatar = document.createElement("div");
      avatar.className = "avatar bot";

      const typing = document.createElement("div");
      typing.className = "typing";
      typing.innerHTML = `<div class="dot"></div><div class="dot"></div><div class="dot"></div>`;

      wrap.appendChild(avatar);
      wrap.appendChild(typing);
      box.appendChild(wrap);
      box.scrollTop = box.scrollHeight;
    }

    function removeTyping() {
      const el = document.getElementById("typingIndicator");
      if (el) el.remove();
    }

    async function sendMessage() {
      const inp = document.getElementById("question");
      const text = inp.value.trim();
      if (!text) return;

      addMessage(text, "user");
      inp.value = "";

      // Show typing indicator
      showTyping();

      const res = await fetch("http://localhost:3000/ask", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ question: text })
      });

      const data = await res.json();

      // Remove typing
      removeTyping();

      // Add bot message
      addMessage(data.answer || "No response", "bot");
    }
  </script>

</body>
</html>
